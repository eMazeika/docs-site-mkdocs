


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lesson 3 - How to create Virto commerce module (API)">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.0">
    
    
      
        <title>Lesson 3 - How to create Virto commerce module (API)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.18ac144a.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-create-virto-commerce-module-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="MkLorum" class="md-header-nav__button md-logo" aria-label="MkLorum">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            MkLorum
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Lesson 3 - How to create Virto commerce module (API)
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MkLorum" class="md-nav__button md-logo" aria-label="MkLorum">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MkLorum
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Dynamic-Property/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Email-sending-settings/" title="Email sending settings documentation" class="md-nav__link">
      Email sending settings documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Generating%20pdf-file/" title="Pdf-file creation support" class="md-nav__link">
      Pdf-file creation support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Implementing-authorization-mechanism-using-JWT/" title="Implementing authorization mechanism using Json Web Tokens" class="md-nav__link">
      Implementing authorization mechanism using Json Web Tokens
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Migrate-module-from-the-Platform-2.0-to-3.0-version/" title="Update VC Platform Module from version 2.x to version 3" class="md-nav__link">
      Update VC Platform Module from version 2.x to version 3
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="Wefwe dfvdv" class="md-nav__link">
      Wefwe dfvdv
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../code-breaking-changes-included-in-v3/" title="Breaking changes included in VirtoCommerce 3.0" class="md-nav__link">
      Breaking changes included in VirtoCommerce 3.0
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../connect-storefront-to-platform-v3/" title="Connect Storefront to Platform" class="md-nav__link">
      Connect Storefront to Platform
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../create-new-module/" title="How to create a new Dummy module" class="md-nav__link">
      How to create a new Dummy module
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../deploy-from-precompiled-binaries-linux/" title="Deploy Platform V3 from precompiled binaries on Linux" class="md-nav__link">
      Deploy Platform V3 from precompiled binaries on Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../deploy-from-precompiled-binaries-windows/" title="Deploy Platform V3 from precompiled binaries on Windows" class="md-nav__link">
      Deploy Platform V3 from precompiled binaries on Windows
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../deploy-from-source-code/" title="Deploy Platform from source code" class="md-nav__link">
      Deploy Platform from source code
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../deploy-module-from-source-code/" title="Deploy Module from source code" class="md-nav__link">
      Deploy Module from source code
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../extend-DB-model/" title="How to extend the DB model of VC module (v3)" class="md-nav__link">
      How to extend the DB model of VC module (v3)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting started (title from metadata)" class="md-nav__link">
      Getting started (title from metadata)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../sharing-bearer-tokens-across-platform-instances/" title="How to sharing bearer tokens across platform instances" class="md-nav__link">
      How to sharing bearer tokens across platform instances
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../swagger-endpoints/" title="Swagger endpoints" class="md-nav__link">
      Swagger endpoints
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../upgrade-storefront-autorest-cli-to-v3/" title="How to upgrade AutoRest-generated clients to VirtoCommerce v3 in the Storefront" class="md-nav__link">
      How to upgrade AutoRest-generated clients to VirtoCommerce v3 in the Storefront
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../using-autorest-with-v3/" title="How to generate AutoRest-generated clients with the Platform v.3" class="md-nav__link">
      How to generate AutoRest-generated clients with the Platform v.3
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../whats-new/" title="Whats new" class="md-nav__link">
      Whats new
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-22" type="checkbox" id="nav-22" checked>
    
    <label class="md-nav__link" for="nav-22">
      My lessons (custom title)
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="My lessons (custom title)" data-md-level="1">
      <label class="md-nav__title" for="nav-22">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        My lessons (custom title)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Lesson 3 - How to create Virto commerce module (API)
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Lesson 3 - How to create Virto commerce module (API)" class="md-nav__link md-nav__link--active">
      Lesson 3 - How to create Virto commerce module (API)
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    Glossary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-new-module" class="md-nav__link">
    Create new module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virto-commerce-template" class="md-nav__link">
    Virto Commerce template
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-new-module-with-the-platform" class="md-nav__link">
    Connect new module with the platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
    <nav class="md-nav" aria-label="Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging-c-code" class="md-nav__link">
    Debugging C# code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#swagger-ui" class="md-nav__link">
    Swagger UI
  </a>
  
    <nav class="md-nav" aria-label="Swagger UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-module-rest-api-endpoints" class="md-nav__link">
    Testing module Rest API Endpoints
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-vc-module-solution-structure" class="md-nav__link">
    The VC module solution structure
  </a>
  
    <nav class="md-nav" aria-label="The VC module solution structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-businessapplication-model" class="md-nav__link">
    .Core Business/Application Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-data-access-logic" class="md-nav__link">
    .Data Data Access Logic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-presentation-logic-and-entry-point" class="md-nav__link">
    .Web Presentation Logic and Entry Point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-project" class="md-nav__link">
    .Tests project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-project" class="md-nav__link">
    Core project
  </a>
  
    <nav class="md-nav" aria-label="Core project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-models" class="md-nav__link">
    Domain models
  </a>
  
    <nav class="md-nav" aria-label="Domain models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity" class="md-nav__link">
    Entity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-criteria" class="md-nav__link">
    Search criteria
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permissions" class="md-nav__link">
    Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaring-new-permissions-in-modulemanifest" class="md-nav__link">
    Declaring new permissions in module.manifest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-project-persistence-layer" class="md-nav__link">
    Data project (Persistence layer)
  </a>
  
    <nav class="md-nav" aria-label="Data project (Persistence layer)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_1" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-and-mapping" class="md-nav__link">
    Entity and mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    Repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services_1" class="md-nav__link">
    Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    Migrations
  </a>
  
    <nav class="md-nav" aria-label="Migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-migration" class="md-nav__link">
    Initial migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-project" class="md-nav__link">
    Web project
  </a>
  
    <nav class="md-nav" aria-label="Web project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_2" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references_1" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulemanifest" class="md-nav__link">
    Module.manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulecs-and-initialization-flow" class="md-nav__link">
    Module.cs and initialization flow
  </a>
  
    <nav class="md-nav" aria-label="Module.cs and initialization flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-database" class="md-nav__link">
    Setup Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-initialization" class="md-nav__link">
    Post initialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-settings" class="md-nav__link">
    Module settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-api-layer" class="md-nav__link">
    WEB API layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-api-endpoints-protection" class="md-nav__link">
    WEB API endpoints protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-rest-api-endpoints-in-swagger" class="md-nav__link">
    Testing Rest API Endpoints in Swagger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests-project_1" class="md-nav__link">
    Tests project
  </a>
  
    <nav class="md-nav" aria-label="Tests project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_3" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references_2" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-implementation" class="md-nav__link">
    Tests implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pack-and-releasedeployment" class="md-nav__link">
    Pack and release/deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lesson4/" title="Lessons 4 - How to build and customize platform manager Web UI (AngularJS)" class="md-nav__link">
      Lessons 4 - How to build and customize platform manager Web UI (AngularJS)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lesson1/" title="Lesson 1 - How to deploy and configure Virto Commerce" class="md-nav__link">
      Lesson 1 - How to deploy and configure Virto Commerce
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lesson2/" title="Lesson 2 - How to import new products into Virto Commerce catalog" class="md-nav__link">
      Lesson 2 - How to import new products into Virto Commerce catalog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      Modules
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Modules" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23-1" type="checkbox" id="nav-23-1">
    
    <label class="md-nav__link" for="nav-23-1">
      Catalog
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Catalog" data-md-level="2">
      <label class="md-nav__title" for="nav-23-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Catalog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/catalog/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      Vc2devguide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Vc2devguide" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Vc2devguide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../vc2devguide/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../vc2devguide/system-requirements/" title="System Requirements - Virto Commerce 2 Developer Guide" class="md-nav__link">
      System Requirements - Virto Commerce 2 Developer Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24-3" type="checkbox" id="nav-24-3">
    
    <label class="md-nav__link" for="nav-24-3">
      Development scenarios
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Development scenarios" data-md-level="2">
      <label class="md-nav__title" for="nav-24-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Development scenarios
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../vc2devguide/development-scenarios/working-with-platform-api/" title="Working with platform API" class="md-nav__link">
      Working with platform API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    Glossary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-new-module" class="md-nav__link">
    Create new module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virto-commerce-template" class="md-nav__link">
    Virto Commerce template
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-new-module-with-the-platform" class="md-nav__link">
    Connect new module with the platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
    <nav class="md-nav" aria-label="Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging-c-code" class="md-nav__link">
    Debugging C# code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#swagger-ui" class="md-nav__link">
    Swagger UI
  </a>
  
    <nav class="md-nav" aria-label="Swagger UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-module-rest-api-endpoints" class="md-nav__link">
    Testing module Rest API Endpoints
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-vc-module-solution-structure" class="md-nav__link">
    The VC module solution structure
  </a>
  
    <nav class="md-nav" aria-label="The VC module solution structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-businessapplication-model" class="md-nav__link">
    .Core Business/Application Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-data-access-logic" class="md-nav__link">
    .Data Data Access Logic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-presentation-logic-and-entry-point" class="md-nav__link">
    .Web Presentation Logic and Entry Point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-project" class="md-nav__link">
    .Tests project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-project" class="md-nav__link">
    Core project
  </a>
  
    <nav class="md-nav" aria-label="Core project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-models" class="md-nav__link">
    Domain models
  </a>
  
    <nav class="md-nav" aria-label="Domain models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entity" class="md-nav__link">
    Entity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-criteria" class="md-nav__link">
    Search criteria
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permissions" class="md-nav__link">
    Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaring-new-permissions-in-modulemanifest" class="md-nav__link">
    Declaring new permissions in module.manifest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-project-persistence-layer" class="md-nav__link">
    Data project (Persistence layer)
  </a>
  
    <nav class="md-nav" aria-label="Data project (Persistence layer)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_1" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-and-mapping" class="md-nav__link">
    Entity and mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    Repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services_1" class="md-nav__link">
    Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    Migrations
  </a>
  
    <nav class="md-nav" aria-label="Migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-migration" class="md-nav__link">
    Initial migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-project" class="md-nav__link">
    Web project
  </a>
  
    <nav class="md-nav" aria-label="Web project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_2" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references_1" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulemanifest" class="md-nav__link">
    Module.manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulecs-and-initialization-flow" class="md-nav__link">
    Module.cs and initialization flow
  </a>
  
    <nav class="md-nav" aria-label="Module.cs and initialization flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-database" class="md-nav__link">
    Setup Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-initialization" class="md-nav__link">
    Post initialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-settings" class="md-nav__link">
    Module settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-api-layer" class="md-nav__link">
    WEB API layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-api-endpoints-protection" class="md-nav__link">
    WEB API endpoints protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-rest-api-endpoints-in-swagger" class="md-nav__link">
    Testing Rest API Endpoints in Swagger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests-project_1" class="md-nav__link">
    Tests project
  </a>
  
    <nav class="md-nav" aria-label="Tests project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preinstalled-nuget-packages_3" class="md-nav__link">
    Preinstalled NuGet packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-references_2" class="md-nav__link">
    Project references
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-implementation" class="md-nav__link">
    Tests implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pack-and-releasedeployment" class="md-nav__link">
    Pack and release/deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="how-to-create-virto-commerce-module-api">How to create Virto commerce module (API)</h1>
<h2 id="summary">Summary</h2>
<p>Use this guide to create a custom module for Virto Commerce Platform. There will be an API created for product reviews management: create, update, delete, search. Hereinafter, this module will be called as "Customer Reviews" module.</p>
<p>After completing this lesson, a new module will be created, including:</p>
<ul>
<li>module API for create, delete, update and search customer reviews;</li>
<li>test project for testing module API.</li>
</ul>
<p>Platform Manager UI for the Virto Commerce "Customer Reviews" module will be created in <a href="/lesson3.md">Lesson 4</a></p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Installed Virto Commerce Platform;</li>
<li>Basic C# knowledge;</li>
<li>Visual Studio 2019 or higher.</li>
</ul>
<h2 id="glossary">Glossary</h2>
<ul>
<li>VC – Virto Commerce;</li>
<li>Platform - Virto Commerce Platform;</li>
<li>Platform Manager – Virto Commerce Platform Manager, UI for Platform managing;</li>
<li>JS – JavaScript;</li>
<li>VS – Visual Studio.</li>
</ul>
<h2 id="create-new-module">Create new module</h2>
<p>New module should be created from a special VC module template in Visual Studio. The template is available as a Visual Studio extension online.</p>
<h2 id="virto-commerce-template">Virto Commerce template</h2>
<p>Open Visual Studio, go to <strong>Tools &gt; Extensions and Updates</strong>. Search for <strong>Virto Commerce 2.x Module Templates</strong>.</p>
<p><img alt="VS Extensions and Updates" src="../../assets/images/docs/screen-vs-extensions-and-updates.png" /></p>
<p>Install it and restart Visual Studio.
Now, in Visual Studio click <strong>New Project</strong>, search for an existing <strong>Virto Commerce 2.x Module</strong>. Name it, according to the naming convention. For example:</p>
<ul>
<li>"Name": <strong>CustomerReviewsModule</strong>;</li>
<li>"Solution name": <strong>CustomerReviewsModule</strong>.</li>
</ul>
<p><img alt="VS New Project" src="../../assets/images/docs/screen-vs-new-project.png" /></p>
<p>After new module created fill in title, description and authors attributes in <em>module.manifest</em> file:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;module&gt;</span>
    ....

    <span class="nt">&lt;title&gt;</span>Sample Customer reviews module<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;description&gt;</span>Sample module demonstrating best practices in a real life example.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;authors&gt;</span>
        <span class="nt">&lt;author&gt;</span>If you read this text, replace it with your name<span class="nt">&lt;/author&gt;</span>
    <span class="nt">&lt;/authors&gt;</span>
    ....
<span class="nt">&lt;module&gt;</span>
</code></pre></div>


<p><em>module.manifest</em> is entry point for a VC module. It entirely defines the module, so that Virto Commerce Platform can install and run the module.</p>
<h2 id="connect-new-module-with-the-platform">Connect new module with the platform</h2>
<p>Now, need to tell the platform that a new module added. For that, connect newly created solution folder to the Platform ~/Modules via the symbolic link:</p>
<ol>
<li>Run Command Prompt as an administrator;</li>
<li>Navigate to the physical location folder of Platform's ~/Modules directory;</li>
<li>Run the following command:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="err">mklink /d CustomerReviewsModule &lt;full_path_to_CustomerReviewsModule_project&gt;</span>
</code></pre></div>


<p>Also, check and set appropriate permissions for the newly created module folder, so that IIS can access it.
Here, for the "IIS_IUSRS" group the required permission is "Read &amp; execute":</p>
<p><img alt="Permissions for CustomerReviewsModule" src="../../assets/images/docs/screen-permissionns-for-customerreviewsmodule.png" /></p>
<p>Compile solution and restart IIS (use iisreset.exe command). After that, CustomerReviews module should appear in Platform Manager. Open it in browser to check how new module looks like.</p>
<p><img alt="CustomerReviesModule in Platform Manager" src="../../assets/images/docs/screen-customerreviesmodule-in-platform-manager.png" /></p>
<p>Click on <strong>CustomerReviewsModule</strong> and you should see "Hello world" blade</p>
<p><img alt="Hellow world! blade" src="../../assets/images/docs/screen-hellow-world-blade.png" /></p>
<h2 id="debugging">Debugging</h2>
<h3 id="debugging-c-code">Debugging C# code</h3>
<p>To debug C# code at run-time you have to attach debugger to IIS instance.
In Visual Studio:</p>
<ol>
<li>Run Studio as an administrator;</li>
<li>Click "Debug" from the menu bar;</li>
<li>Click "Attach to Process";</li>
<li>Check the "Show processes from all users" checkbox in the bottom left corner;</li>
<li>Select aspnet_wp.exe, w3p.exe, or w3wp.exe from the process list;</li>
<li>Click "Attach".</li>
</ol>
<h3 id="swagger-ui">Swagger UI</h3>
<p>"REST API documentation" (Swagger) UI is automatically generated page. It enables to make requests to all the REST API endpoints exposed by Platform and installed modules as well. Browse <strong>[localhost/admin/docs/ui/index]</strong> URL:</p>
<p><img alt="Swagger UI" src="../../assets/images/docs/screen-swagger-ui.png" /></p>
<h4 id="authorization">Authorization</h4>
<p>Call Authorize button on the top of the page, enter username and password, submit the form in order to be able to use the secured API methods.</p>
<h4 id="testing-module-rest-api-endpoints">Testing module Rest API Endpoints</h4>
<p>Click on "Sample Customer reviews module" to see the available endpoints.
When the new module is generated from a template, there is only one endpoint <strong>api/CustomerReviewsModule</strong> included, returning "Hello, world!":</p>
<p><img alt="Swagger Get API" src="../../assets/images/docs/screen-swagger-get-api.png" /></p>
<h2 id="the-vc-module-solution-structure">The VC module solution structure</h2>
<p>"Customer review" solution consists of 4 logically divided parts (projects):</p>
<ul>
<li><strong>CustomerReviewsModule.Core</strong> with following folder structure:</li>
<li>Models;</li>
<li>Services.</li>
<li><strong>CustomerReviewsModule.Data</strong> with following folder structure:</li>
<li>Migrations;</li>
<li>Models;</li>
<li>Repositories;</li>
<li>Services.</li>
<li><strong>CustomerReviewsModule.Web</strong> with following folder structure:</li>
<li>Controllers:<ul>
<li>API.</li>
</ul>
</li>
<li>Scripts:<ul>
<li>blades;</li>
<li>Resources.</li>
</ul>
</li>
<li>Content.</li>
<li><strong>CustomerReviewsModule.Tests</strong>.</li>
</ul>
<p>In the solution, each project has its own responsibilities. Thus, certain types belong to each project, and you can always find the folders corresponding to these types in the corresponding project.</p>
<p>The figure below shows a representation of the layers of architecture. Notice that the solid arrows correspond to the compile-time dependencies, and the dashed arrows to the dependencies that exist only at run time. As part of the current architecture, a Web project works with interfaces that are defined in the Core project at compile time, and ideally should not know anything about the implementation types defined in the Data project. But at run time, these types of implementations are necessary to run the application, so they must exist and be tied to the interfaces of the Core project through dependency injection.</p>
<p><img alt="Solution arch scheme" src="../../assets/images/docs/scheme-solution-arch.png" /></p>
<h3 id="core-businessapplication-model">.Core Business/Application Model</h3>
<p>The project must contain a business model, services and interfaces. These interfaces should include abstractions for operations that will be performed using infrastructure, such as data access, file system access, network calls, etc. In addition, services or interfaces defined at this level can work with non-object types. that are independent of the user. interface or infrastructure and are defined as simple data transfer objects (DTO).</p>
<h3 id="data-data-access-logic">.Data Data Access Logic</h3>
<p>The project includes the implementation of data access. Namely, the data access implementation classes (Repositories), any EF Migration objects that have been defined, and EF Entities models. In addition to the data access implementations, the project must contain service implementations that must interact with infrastructure problems. These services must implement the interfaces defined in Core, and therefore the project must have a reference to the Core project.</p>
<h3 id="web-presentation-logic-and-entry-point">.Web Presentation Logic and Entry Point</h3>
<p>The user interface level in an ASP.NET MVC application is the entry point for the application. This project must refer to the Core project, and its types must interact with the data layer strictly through the interfaces defined in Core. Direct creation or static calls for user-level data types are not allowed at the user interface level.</p>
<p>The Startup class is responsible for setting up the application and connecting the implementation types to the interfaces, which allows you to correctly inject dependencies at runtime. And to enable dependency injection in ConfigureServices in the Startup.cs file of the user interface project, it refers to data projects.</p>
<h3 id="tests-project">.Tests project</h3>
<p><strong>.Tests project</strong> uses for testing the service and repository layer methods with Unit test.</p>
<p>This structure sets up automatically when module solution created from Virto Commerce template.</p>
<h2 id="core-project">Core project</h2>
<p>All the abstractions are defined in the <strong>CustomerReviewsModule.Core</strong> project.</p>
<p>Typical structure of <strong>Core</strong> project is:</p>
<ul>
<li>Models - contains domain models that you want to introduce to VirtoCommerce platform and Search Criteria for support search:</li>
<li>Entities;</li>
<li>Search Criteria.</li>
<li>Services - declaration of CRUD and search services without implementations:</li>
<li>CRUD service interface;</li>
<li>Search interface.</li>
</ul>
<h3 id="preinstalled-nuget-packages">Preinstalled NuGet packages</h3>
<p>After the project is created from the template, the following packages will be automatically installed:</p>
<ul>
<li><strong>VirtoCommerce.Platform.Core</strong>;</li>
<li><strong>VirtoCommerce.Domain</strong>.</li>
</ul>
<h3 id="domain-models">Domain models</h3>
<p>All domain models should be located in <strong>CustomerReviewsModule.Core\Models</strong> folder.</p>
<h4 id="entity">Entity</h4>
<p>CustomerReviews entity defined as base domain class:</p>
<div class="codehilite"><pre><span></span><code><span class="k">namespace</span> <span class="nn">CustomerReviews.Core.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerReview</span> <span class="p">:</span> <span class="n">AuditableEntity</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">AuthorNickname</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Content</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsActive</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>It contains all the mandatory data related to customer’s review: The author’s nickname, review content, the status(active/inactive) and product ID which user reviewed.</p>
<h4 id="search-criteria">Search criteria</h4>
<p>Define criteria to search for reviews such as <strong>CustomerReviewSearchCriteria</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerReviewSearchCriteria</span> <span class="p">:</span> <span class="n">SearchCriteriaBase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">ProductIds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool?</span> <span class="n">IsActive</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>In this case, the client can search by products and review status.</p>
<h3 id="services">Services</h3>
<p>In order to use created models, need to create services. In <strong>CustomerReviewsModule.Core\Services</strong> folder will define the abstractions for customer’s review services.</p>
<p>For example, the <strong>ICustomerReviewService</strong> interface:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">interface</span> <span class="n">ICustomerReviewService</span>
<span class="p">{</span>
    <span class="n">CustomerReview</span><span class="p">[]</span> <span class="nf">GetByIds</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">ids</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">SaveCustomerReviews</span><span class="p">(</span><span class="n">CustomerReview</span><span class="p">[]</span> <span class="n">items</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">DeleteCustomerReviews</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">ids</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<p>Here define methods to get, save and delete customer reviews.
And a separate service is for the search. <strong>ICustomerReviewSearchService</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">interface</span> <span class="n">ICustomerReviewSearchService</span>
<span class="p">{</span>
    <span class="n">GenericSearchResult</span><span class="p">&lt;</span><span class="n">CustomerReview</span><span class="p">&gt;</span> <span class="n">SearchCustomerReviews</span><span class="p">(</span><span class="n">CustomerReviewSearchCriteria</span> <span class="n">criteria</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="permissions">Permissions</h3>
<p>In <strong>ModuleConstants.cs</strong> declared basic module permissions which describes particular right of action and has a string presentation which is used in permission checks. These permissions will be used below in the description API methods in <strong>CustomerReviewsModule.Web</strong> project.</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Security</span>
<span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Permissions</span>
   <span class="p">{</span>
      <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Read</span> <span class="p">=</span> <span class="s">&quot;CustomerReviewsModule:read&quot;</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Update</span> <span class="p">=</span> <span class="s">&quot;CustomerReviewsModule:update&quot;</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Delete</span> <span class="p">=</span> <span class="s">&quot;CustomerReviewsModule:delete&quot;</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>With them you control the API access allowing to read, update or perform delete operation. These permission checks are also used in frontend part as well.</p>
<h3 id="declaring-new-permissions-in-modulemanifest">Declaring new permissions in module.manifest</h3>
<p>Permissions are also declared in module manifest.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;module&gt;</span>
....
    <span class="nt">&lt;permissions&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;CustomerReviewsModule&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;CustomerReviewsModule:read&quot;</span> <span class="na">name=</span><span class="s">&quot;Read&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;CustomerReviewsModule:update&quot;</span> <span class="na">name=</span><span class="s">&quot;Update&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;CustomerReviewsModule:delete&quot;</span> <span class="na">name=</span><span class="s">&quot;Delete&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>
    <span class="nt">&lt;/permissions&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</code></pre></div>


<p>You can read more about permissions in <a href="https://virtocommerce.com/docs/vc2devguide/working-with-platform-manager/basic-functions/working-with-platform-security">Working with platform security</a></p>
<h2 id="data-project-persistence-layer">Data project (Persistence layer)</h2>
<p>For the persistence or Data Access Layer (DAL) solution has a separate project called <strong>Data</strong>. Here implemented all the interfaces defined in <strong>Core</strong> project. Moreover, it contains all the persistence and data access abstractions, and mappings as well.</p>
<p>Typical structure of <strong>Data</strong> project is:</p>
<ul>
<li>Models - separate classes have each of the entities that you created previously in <strong>Core</strong> project, typically they have the conversion methods from domain model to persistency model</li>
<li>{Entity}.ToModel()</li>
<li>{Entity}.FromModel()</li>
<li>{Entity}.Patch()</li>
<li>Repositories - contains classes for making requests to database</li>
<li>Migrations - contains code to manage incremental changes and version control to database</li>
<li>Services - implementation of services that were previously declared in <strong>Core</strong> project</li>
</ul>
<h3 id="preinstalled-nuget-packages_1">Preinstalled NuGet packages</h3>
<p>After the project is created from the template, the following NuGet packages will be automatically installed:</p>
<ul>
<li><strong>VirtoCommerce.Platform.Core</strong>;</li>
<li><strong>VirtoCommerce.Platform.Data</strong>;</li>
<li><strong>VirtoCommerce.Domain</strong>.</li>
</ul>
<h3 id="project-references">Project references</h3>
<p><strong>CustomerReviewsModule.Data</strong> project has reference to <strong>CustomerReviewsModule.Core</strong> project.</p>
<h3 id="entity-and-mapping">Entity and mapping</h3>
<p>Now need to create data access layer models and map it to the base domain class. All data access layer models should be located in <strong>CustomerReviewsModule.Data\Models</strong> folder.</p>
<p>The example of the CustomerReview  data access layer model implementation you can find in sample the <a href="https://github.com/VirtoCommerce/vc-samples/tree/master/CustomerReviews">repository</a>.</p>
<h3 id="repositories">Repositories</h3>
<p>As a new type of abstraction, Data project has repositories defined in it. For example, you can notice <strong>ICustomerReviewRepository</strong> used in <strong>CustomerReviewService</strong>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">interface</span> <span class="n">ICustomerReviewRepository</span> <span class="p">:</span> <span class="n">IRepository</span>
<span class="p">{</span>
    <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">CustomerReviewEntity</span><span class="p">&gt;</span> <span class="n">CustomerReviews</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="n">CustomerReviewEntity</span><span class="p">[]</span> <span class="nf">GetByIds</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">ids</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">DeleteCustomerReviews</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">ids</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<p><strong>ICustomerReviewRepository</strong> interface contains only the declaration of the methods, properties. Implementation of the interface <strong>ICustomerReviewRepository</strong> uses Entity Framework under the hood. The Interface and the implementation can find in the sample <a href="https://github.com/VirtoCommerce/vc-samples/tree/master/CustomerReviews">repository</a>.
The interface and its implementation should be located in <strong>CustomerReviewsModule.Data\Repositories</strong> folder.</p>
<h3 id="services_1">Services</h3>
<p>The implementations of the services that was defined early in <strong>CustomerReviewsModule.Core</strong> project should be located in <strong>CustomerReviewsModule.Data\Services</strong> folder. The example of the services implementation you can find in the sample <a href="https://github.com/VirtoCommerce/vc-samples/tree/master/CustomerReviews">repository</a>.</p>
<h3 id="migrations">Migrations</h3>
<p>In order to define the data access layer based on Entity Framework use the package manager tools in Visual Studio. From the VS top menu chooses <strong>Tools&gt;Module Package Manager&gt;Package Manager Console</strong>.</p>
<p><img alt="Package Manager Console" src="../../assets/images/docs/screen-package-manager-console.png" /></p>
<p>There is a command to enable migrations:</p>
<div class="codehilite"><pre><span></span><code><span class="err">enable-migrations –MigrationsDirectory Migrations</span>
</code></pre></div>


<p>In the dropdown menu choose the <strong>CustomerReviewsModule.Data</strong> project. The command run will create a new migration configuration.</p>
<p>Note, that by default the automatic migrations are switched off:</p>
<div class="codehilite"><pre><span></span><code><span class="n">AutomaticMigrationsEnabled</span> <span class="p">=</span> <span class="k">false</span>
</code></pre></div>


<h4 id="initial-migration">Initial migration</h4>
<p>For generate the initial migration use this script:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Add-Migration Initial -ConnectionString &quot;Data Source=(local);Initial Catalog=VirtoCommerce2;Persist Security Info=True;User ID=virto;Password=virto;MultipleActiveResultSets=True;Connect Timeout=420&quot; -ConnectionProviderName &quot;System.Data.SqlClient&quot;</span>
</code></pre></div>


<p>This will generate the <strong>dbo.CustomerReview</strong> migration script. Keep in mind, that in case "Down migration" developer should take care of removing the module with all its dependencies.
Now the Data Access Layer is ready.</p>
<h2 id="web-project">Web project</h2>
<p>This is most important project in the solution.</p>
<p>Typical structure of <strong>Web</strong> project is:</p>
<ul>
<li>Controllers - API controllers, all methods defined here wil be available from platform instance;</li>
<li>Scripts - entry point for Platform Manager user interface;</li>
<li>Module.manifest - the main file containing new module definition;</li>
<li>Module.cs - main entry point for module backend, containing database initialization, registration of new repositories, services, model types and overrides.</li>
</ul>
<h3 id="preinstalled-nuget-packages_2">Preinstalled NuGet packages</h3>
<p>After the project is created from the template, the following NuGet packages will be automatically installed:</p>
<ul>
<li><strong>VirtoCommerce.Platform.Core.Web</strong>;</li>
<li><strong>VirtoCommerce.Platform.Data</strong>;</li>
<li><strong>VirtoCommerce.Domain</strong>.</li>
</ul>
<h3 id="project-references_1">Project references</h3>
<p><strong>CustomerReviewsModule.Web</strong> project has reference to <strong>CustomerReviewsModule.Core</strong> and <strong>CustomerReviewsModule.Data</strong> projects.</p>
<h3 id="modulemanifest">Module.manifest</h3>
<p><em>module.manifest</em> contains various attributes describing the module and its contents which is necessary for the Platform to connect the module to the platform. The Platform searches for CustomerReviewModule <em>module.manifest</em> file, gets the entry point and connects the module to the platform.</p>
<p>Typical <em>module.manifest</em> structure is:</p>
<ul>
<li>Identifier - a new module identifier for Platform, each modules identifier should be unique:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;id&gt;</span>CustomerReviews.Web<span class="nt">&lt;/id&gt;</span>
</code></pre></div>


<ul>
<li>Versioning - actual version of a new module and required Platform version:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;platformVersion&gt;</span>2.13.9<span class="nt">&lt;/platformVersion&gt;</span>
</code></pre></div>


<ul>
<li>Dependencies - list of modules with versions whose functions will be used in a new module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependenci</span> <span class="na">id=</span><span class="s">&quot;VirtoCommerce.Core&quot;</span> <span class="na">version=</span><span class="s">&quot;2.25.21&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>


<ul>
<li>Title and description - name and description of a new module that will be displayed in the Platform Manager and Swagger:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;title&gt;</span>Sample Customer reviews module<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;description&gt;</span>Sample module demonstrating best practices in a real life example.<span class="nt">&lt;/description&gt;</span>
</code></pre></div>


<ul>
<li>Authors - names of programmers who wrote a new module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;authors&gt;</span>
    <span class="nt">&lt;author&gt;</span>Egidijus Mazeika<span class="nt">&lt;/author&gt;</span>
<span class="nt">&lt;/authors&gt;</span>
</code></pre></div>


<ul>
<li>AssemblyFile and ModuleType - auto generated data witch Platform use under the hood to connect a new module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;assemblyFile&gt;</span>CustomerReviews.Web.dll<span class="nt">&lt;/assemblyFile&gt;</span>
<span class="nt">&lt;moduleType&gt;</span>CustomerReviews.Web.Module, CustomerReviews.Web<span class="nt">&lt;/moduleType&gt;</span>
</code></pre></div>


<ul>
<li>Styles - path for additional styles for a new module user interface:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;styles&gt;</span>
    <span class="nt">&lt;directory</span> <span class="na">virtualPath=</span><span class="s">&quot;$/Content/css&quot;</span> <span class="na">searchPattern=</span><span class="s">&quot;*.css&quot;</span> <span class="na">searchSubdirectories=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/styles&gt;</span>
</code></pre></div>


<ul>
<li>Scripts - path for a new module user interface scripts:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;scripts&gt;</span>
    <span class="nt">&lt;directory</span> <span class="na">virtualPath=</span><span class="s">&quot;$/Scripts&quot;</span> <span class="na">searchPattern=</span><span class="s">&quot;*.js&quot;</span> <span class="na">searchSubdirectories=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/scripts&gt;</span>
</code></pre></div>


<ul>
<li>Settings - define custom settings for a new module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;settings&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;Store|General&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;setting&gt;</span>
            <span class="nt">&lt;name&gt;</span>CustomerReviews.CustomerReviewsEnabled<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;valueType&gt;</span>boolean<span class="nt">&lt;/valueType&gt;</span>
            <span class="nt">&lt;defaultValue&gt;</span>false<span class="nt">&lt;/defaultValue&gt;</span>
            <span class="nt">&lt;title&gt;</span>Customer Reviews enabled<span class="nt">&lt;/title&gt;</span>
            <span class="nt">&lt;description&gt;</span>Flag to mark that customer reviews functionality is enabled<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;/setting&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div>


<ul>
<li>Permissions - define custom permissions for a new module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;permissions&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;Customer Reviews&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;customerReview:read&quot;</span> <span class="na">name=</span><span class="s">&quot;Read Customer Reviews&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;customerReview:update&quot;</span> <span class="na">name=</span><span class="s">&quot;Update Customer Review&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;permission</span> <span class="na">id=</span><span class="s">&quot;customerReview:delete&quot;</span> <span class="na">name=</span><span class="s">&quot;Delete Customer Review&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/permissions&gt;</span>
</code></pre></div>


<h3 id="modulecs-and-initialization-flow">Module.cs and initialization flow</h3>
<p><em>Module.cs</em> is the main entry point of managed code, the base class for the entire module. In this case, it’s Customer Reviews module. Module initialization flow contains several steps:</p>
<ul>
<li>Setup Database;</li>
<li>Initialization:</li>
<li>Services registration;</li>
<li>Post initialization:</li>
<li>Override registrations;</li>
<li>Store dependent settings registration.</li>
</ul>
<h4 id="setup-database">Setup Database</h4>
<p>First step is to registry repositories defined in <strong>Data</strong> project (including migrations) and initialize database. The database is initialized in the <strong>SetupDatabase()</strong> method:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">SetupDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerReviewRepository</span><span class="p">(</span><span class="n">_connectionString</span><span class="p">,</span> <span class="n">_container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">&lt;</span><span class="n">AuditableInterceptor</span><span class="p">&gt;()))</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">initializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SetupDatabaseInitializer</span><span class="p">&lt;</span><span class="n">CustomerReviewRepository</span><span class="p">,</span> <span class="n">Data</span><span class="p">.</span><span class="n">Migrations</span><span class="p">.</span><span class="n">Configuration</span><span class="p">&gt;();</span>
        <span class="n">initializer</span><span class="p">.</span><span class="n">InitializeDatabase</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="initialization">Initialization</h4>
<p>Interfaces are using in services in CustomerReviews module. That’s because a dependency injection always used. Inside of <strong>Initialize()</strong> method in the Main class register the Service implementations of the module and link them with the interfaces:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Initialize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">base</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

    <span class="c1">// This method is called for each installed module on the first stage of initialization.</span>

    <span class="c1">// Register implementations:</span>
    <span class="n">_container</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">ICustomerReviewRepository</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">InjectionFactory</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">CustomerReviewRepository</span><span class="p">(</span><span class="n">_connectionString</span><span class="p">,</span> <span class="k">new</span> <span class="n">EntityPrimaryKeyGeneratorInterceptor</span><span class="p">(),</span> <span class="n">_container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">&lt;</span><span class="n">AuditableInterceptor</span><span class="p">&gt;())));</span>
    <span class="n">_container</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">ICustomerReviewSearchService</span><span class="p">,</span> <span class="n">CustomerReviewSearchService</span><span class="p">&gt;();</span>
    <span class="n">_container</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">ICustomerReviewService</span><span class="p">,</span> <span class="n">CustomerReviewService</span><span class="p">&gt;();</span>
<span class="p">}</span>
</code></pre></div>


<p>The method registers a specific signature for the type that will be injected for the ICustomerReviewRepository interface with a predefined connection string with the database, Id generator and interceptors (for uniformity of work with the database). By calling this line only a factory method registered to be executed during the DI.</p>
<p>This is called a loose coupling mechanism.</p>
<h4 id="post-initialization">Post initialization</h4>
<p>If you need to override existing registrations or register new store dependent settings you can do this in <strong>PostInitialize()</strong> method.</p>
<h3 id="module-settings">Module settings</h3>
<p>A setting is a parameter that a module accepts. More details on settings: https://virtocommerce.com/docs/vc2devguide/working-with-platform-manager/extending-functionality/managing-module-settings</p>
<p>First of all define <em>CustomerReviews.CustomerReviewsEnabled</em> setting in <em>module.manifest</em> like this:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;settings&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;Store|General&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;setting&gt;</span>
            <span class="nt">&lt;name&gt;</span>CustomerReviews.CustomerReviewsEnabled<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;valueType&gt;</span>boolean<span class="nt">&lt;/valueType&gt;</span>
            <span class="nt">&lt;defaultValue&gt;</span>false<span class="nt">&lt;/defaultValue&gt;</span>
            <span class="nt">&lt;title&gt;</span>Customer Reviews enabled<span class="nt">&lt;/title&gt;</span>
            <span class="nt">&lt;description&gt;</span>Flag to mark that customer reviews functionality is enabled<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;/setting&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div>


<p>A new, global module setting is defined. Make the Reviews enabled/disabled setting value configurable for each individual store (scope-bounded):</p>
<ul>
<li>get instance of <strong>ISettingsManager</strong>;</li>
<li>define a list of settings that will be scope-bounded;</li>
<li>get the actual definitions of those settings;</li>
<li>register the settings as scope-bounded in "VirtoCommerce.Store" module:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">PostInitialize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">base</span><span class="p">.</span><span class="n">PostInitialize</span><span class="p">();</span>

    <span class="c1">//Registering settings to store module allows to use individual values in each store</span>
    <span class="kt">var</span> <span class="n">settingManager</span> <span class="p">=</span> <span class="n">_container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">&lt;</span><span class="n">ISettingsManager</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">storeSettingsNames</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&quot;CustomerReviews.CustomerReviewsEnabled&quot;</span> <span class="p">};</span>
    <span class="kt">var</span> <span class="n">storeSettings</span> <span class="p">=</span> <span class="n">settingManager</span><span class="p">.</span><span class="n">GetModuleSettings</span><span class="p">(</span><span class="s">&quot;CustomerReviews.Web&quot;</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">storeSettingsNames</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">)).</span><span class="n">ToArray</span><span class="p">();</span>
    <span class="n">settingManager</span><span class="p">.</span><span class="n">RegisterModuleSettings</span><span class="p">(</span><span class="s">&quot;VirtoCommerce.Store&quot;</span><span class="p">,</span> <span class="n">storeSettings</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="web-api-layer">WEB API layer</h3>
<p>For access and use CustomerReviews module services a WEB API layer defined. Search, CRUD and module specific operations are exposed there.</p>
<p>For example, look at searching endpoint:</p>
<div class="codehilite"><pre><span></span><code><span class="na">[HttpPost]</span>
<span class="na">[Route(&quot;search&quot;)]</span>
<span class="na">[ResponseType(typeof(GenericSearchResult&lt;CustomerReview&gt;))]</span>
<span class="na">[CheckPermission(Permission = Permissions.Read)]</span>
<span class="k">public</span> <span class="n">IHttpActionResult</span> <span class="nf">SearchCustomerReviews</span><span class="p">(</span><span class="n">CustomerReviewSearchCriteria</span> <span class="n">criteria</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">GenericSearchResult</span><span class="p">&lt;</span><span class="n">CustomerReviews</span><span class="p">&gt;</span> <span class="n">result</span> <span class="p">=</span> <span class="n">_customerReviewSearchService</span><span class="p">.</span><span class="n">SearchCustomerReviews</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
     <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<p>There isn’t much code in the method. The customer reviews search Service calling directly. Of course, here as well, will use the <strong>ICustomerReviewRepository</strong> abstraction and not the service implementation itself.</p>
<p>The API endpoints are all accessed from the JavaScript code written in the <strong>CustomerReviewsModule</strong>.</p>
<h3 id="web-api-endpoints-protection">WEB API endpoints protection</h3>
<p>Protecting API controller methods with CheckPermission attribute:</p>
<div class="codehilite"><pre><span></span><code><span class="na">[CheckPermission(Permission = Permissions.Read)]</span>
</code></pre></div>


<h3 id="testing-rest-api-endpoints-in-swagger">Testing Rest API Endpoints in Swagger</h3>
<p>Besides the JavaScript, you can test module API endpoints, with the Swagger. Compile solution and restart IIS (use iisreset.exe command). Open the Swagger interface URL: <strong>[localhost//admin/docs/ui/index]</strong> and click on "Customer reviews module" to see the available endpoints.
You can test the search functionality for instance. Under the <strong>api/CustomerReviewsModule/search</strong> endpoint you can create simple or nested, compound criteria. It accepts the criteria as a simple object. After providing the criteria hit the "Try it out" button.</p>
<p><img alt="Swagger Search API" src="../../assets/images/docs/screen-swagger-search-api.png" /></p>
<h2 id="tests-project_1">Tests project</h2>
<p>xUnit testing framework used for test project in module solution.</p>
<h3 id="preinstalled-nuget-packages_3">Preinstalled NuGet packages</h3>
<p>After the project is created from the template, the following NuGet packages will be automatically installed:</p>
<ul>
<li><strong>xUnit.Net</strong>;</li>
<li><strong>xunit.runner.visualstudio</strong>;</li>
<li>Virto Commerce packages referenced in <strong>Core</strong> and <strong>Data</strong> projects.</li>
</ul>
<h3 id="project-references_2">Project references</h3>
<p><strong>CustomerReviewsModule.Tests</strong> project has reference to <strong>CustomerReviewsModule.Core</strong> and <strong>CustomerReviewsModule.Data</strong> projects.</p>
<h3 id="tests-implementation">Tests implementation</h3>
<p>We recommend to use <a href="https://docs.microsoft.com/en-us/dotnet/core/testing/unit-testing-best-practices">"Unit testing best practices with .NET Core and .NET Standard"</a> in tests development.</p>
<p>Actual code for CustomerReviewsModule.Tests project you can find in the sample <a href="https://github.com/VirtoCommerce/vc-samples/tree/master/CustomerReviews">repository</a>.</p>
<h2 id="pack-and-releasedeployment">Pack and release/deployment</h2>
<p>To deploy CustomerReviews module to other platforms use the package manager tool. The command for that is:</p>
<div class="codehilite"><pre><span></span><code><span class="err">compress-module</span>
</code></pre></div>


<p>After execution, the command will create the .zip module package. You can deploy it to the other environment. Go to <strong>Modules&gt;Advanced&gt;Install/update module from file</strong>. Upload the .zip file that created with package manager. After checking, the upload details hit the <strong>Install</strong> button. <strong>Restart</strong> the application.</p>
<p>Under the hood, the application will unzip the file, check the structure, and copy all the required classes to the Modules folder of the current application.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../whats-new/" title="Whats new" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Whats new
              </div>
            </div>
          </a>
        
        
          <a href="../lesson4/" title="Lessons 4 - How to build and customize platform manager Web UI (AngularJS)" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Lessons 4 - How to build and customize platform manager Web UI (AngularJS)
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>